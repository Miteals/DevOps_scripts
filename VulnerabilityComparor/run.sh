set -eu #exit script when unset variable and exit script on every error
IMAGE_OLD=$1; shift
IMAGE_NEW=$1; shift
TRIVY_PARAMS=$@

#to do check trivy version

docker pull $IMAGE_OLD
docker pull $IMAGE_NEW

echo "--> trivy image --format json $TRIVY_PARAMS --output trivy_scan_old.json --no-progress $IMAGE_OLD" 
trivy image --format json $TRIVY_PARAMS --output trivy_scan_old.json --no-progress $IMAGE_OLD
echo "--> trivy image --format json $TRIVY_PARAMS --output trivy_scan_new.json --no-progress $IMAGE_NEW" 
trivy image --format json $TRIVY_PARAMS --output trivy_scan_new.json --no-progress $IMAGE_NEW

python3 comparator.py

